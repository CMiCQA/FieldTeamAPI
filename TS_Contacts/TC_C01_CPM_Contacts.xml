<?xml version="1.0" encoding="UTF-8"?>
<con:testCase xmlns:con="http://eviware.com/soapui/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="4ee11670-2fb4-4d72-87d3-2dfdf6ed8c4e" discardOkResults="false" failOnError="false" failTestCaseOnErrors="true" keepSession="false" name="TC_C01_CPM_Contacts" searchProperties="true" timeout="0">
  <con:settings id="86077f0d-8501-4139-be1d-ac30b878b008">
    <con:setting id="bd51a022-46d7-4772-95a5-d0e024ad90b7fileName">TC_C01_CPM_Contacts</con:setting>
    <con:setting id="4ee11670-2fb4-4d72-87d3-2dfdf6ed8c4efileName">TC_C01_CPM_Contacts</con:setting>
  </con:settings>
  <con:testStep type="datasource" name="Data Source" id="81c8c7d5-b8aa-46f3-bb3f-1b665fd10901">
    <con:settings/>
    <con:config xsi:type="con:DataSourceStep">
      <con:dataSource type="Data Generator">
        <con:configuration>
          <generatedDataCount>1</generatedDataCount>
          <generatorsTotalNumber>1</generatorsTotalNumber>
          <lastSelectedProperty>0</lastSelectedProperty>
          <GeneratorType0>STR</GeneratorType0>
          <PropertyName0>VUuid</PropertyName0>
          <repetitionCountVUuid>0</repetitionCountVUuid>
          <repeatValuesVUuid>false</repeatValuesVUuid>
          <PasswordDataGeneratorUseSpacesVUuid>false</PasswordDataGeneratorUseSpacesVUuid>
          <PasswordDataGeneratorUsePunctuationMarksVUuid>false</PasswordDataGeneratorUsePunctuationMarksVUuid>
          <PasswordDataGeneratorUseLettersVUuid>true</PasswordDataGeneratorUseLettersVUuid>
          <PasswordDataGeneratorUseDigitsVUuid>true</PasswordDataGeneratorUseDigitsVUuid>
          <PasswordDataGeneratorMaxCharacterCountVUuid>10</PasswordDataGeneratorMaxCharacterCountVUuid>
          <PasswordDataGeneratorMinCharacterCountVUuid>5</PasswordDataGeneratorMinCharacterCountVUuid>
          <escapeSpaceSequence/>
        </con:configuration>
      </con:dataSource>
      <con:shared>true</con:shared>
      <con:restartShared>true</con:restartShared>
      <con:property>VUuid</con:property>
      <con:restartOnRun>true</con:restartOnRun>
      <con:stopDatasourceExhausted>false</con:stopDatasourceExhausted>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Login" id="28cd1fb3-67bc-4233-b381-1d160628fbb4">
    <con:settings/>
    <con:config service="ConstructPM Webservices" methodName="Login" resourcePath="/cmic-field-rest-api/jersey/v1/login/{cmic-env}" xsi:type="con:RestRequestStep">
      <con:restRequest name="Login" id="dd3deeb3-b92e-4688-bae8-3c451e379e74" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request/>
        <con:originalUri>https://nova-mobile-test.cmiccloud.com/cmictestnew/cmic-field-rest-api/jersey/v1/login/</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="748beaf4-c442-470d-b2d0-17f69ffd6671" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="6389098b-38c2-45de-9085-2117c1c02304" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters/>
        <con:environmentSpec>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Get Contacts By Project" id="43410b90-e8e0-4f31-ae67-f01f56be7ad6">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/rest/1/contacts" methodName="Get Contacts" xsi:type="con:RestRequestStep">
      <con:restRequest name="Get Contacts By Project" id="8c8eb13a-2d6c-4221-8cf1-4f3e7eb76e35" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request/>
        <con:originalUri>https://qalatestmob.cmicpaas.com/cmicqalatest/cmic-field-rest-api/rest/1/contacts</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="4f7f4317-382a-49ed-a896-c629a010063b" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="cd639eff-151c-4c38-be24-65f292823a6d" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="finder" value="searchbyname;projOraseq=${Login#Response#$['defaultProjectOraseq']}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Get Contacts By Partner Code" id="449cee20-797a-4804-9e14-11bc7141bf87">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/rest/1/contacts" methodName="Get Contacts" xsi:type="con:RestRequestStep">
      <con:restRequest name="Get Contacts By Partner Code" id="8c8eb13a-2d6c-4221-8cf1-4f3e7eb76e35" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request/>
        <con:originalUri>https://qalatestmob.cmicpaas.com/cmicqalatest/cmic-field-rest-api/rest/1/contacts</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="def58b28-9a8b-4f6c-b757-7fc3702a82bb" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="1b4822ca-7ce0-4ac6-8716-75f678262fee" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="finder" value="searchbyname;projOraseq=${Login#Response#$['defaultProjectOraseq']},contactCode=${Login#Response#$['contactCode']},partnCode=${Login#Response#$['partnerCode']},partnTCode=${Login#Response#$['partnerTypeCode']}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Create New Contact With Valid Data" id="6aeba2c8-0784-4b3f-8bbb-5335c797ec10">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/rest/1/contacts" methodName="Create Contact" xsi:type="con:RestRequestStep">
      <con:restRequest name="Create New Contact With Valid Data" id="2bfb29e8-5804-4596-8e9f-91a4c3d99047" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request>{\r
   "PmpcCompCode" : "${Login#Response#$['companyCode']}",\r
   "PmpcFirstName" : "AT1235698",\r
   "PmpcLastName" : "aa188",\r
   "PmpcPartnCode" : "ZZ",\r
   "PmpcPartnTypeCode" : "C",\r
   "PmpcProjOraseq" : "${Login#Response#$['defaultProjectOraseq']}",\r
   "PmpcProjContactOnlyFlag" : "N",\r
   "VUuid" : "${Data Source#VUuid}"\r
}</con:request>
        <con:originalUri>https://qamob.cmicpaas.com/cmicqadaily/cmic-field-rest-api/rest/1/contacts</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="6e629c88-1f31-4d8d-928b-5dd7f6147d0b" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>201</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="d3bf2b20-d628-4611-ace8-c86617564e9c" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters/>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Update Contact" id="16583f96-81cf-49af-9f0d-30eefe833d2e">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/rest/1/contacts/{VUUID}" methodName="Update Contact" xsi:type="con:RestRequestStep">
      <con:restRequest name="Update Contact" id="9002a0d7-1931-46f5-989a-44ac02627538" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request>{\r
   "PmpcFirstName" : "RJTEST",\r
   "VUuid" : "${Create New Contact With Valid Data#Response#$['VUuid']}"\r
}</con:request>
        <con:originalUri>https://qamob.cmicpaas.com/cmicqadaily/cmic-field-rest-api/rest/1/contacts/j5nCx0ZF</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="8376dde3-bd54-40ca-ba30-4fb682ead9e4" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="1a3d3d4a-4113-4611-bb2e-88b09687f543" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="VUUID" value="${Create New Contact With Valid Data#Response#$['VUuid']}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Assign Contact To Project" id="3d07cc54-c7a8-48c2-a8ec-750b1f45ca81">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/jersey/v1/contacts/assign-to-project" methodName="Method 1" xsi:type="con:RestRequestStep">
      <con:restRequest name="Assign Contact To Project" id="d4d6ff0f-772d-494f-94c6-28d7e050f721" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request>{\r
   "17012801" : {\r
      "PmpcProjOraseq" : "${Login#Response#$['defaultProjectOraseq']}",\r
      "PmpcContactOraseq" : "${Create New Contact With Valid Data#Response#$['PmpcContactOraseq']}",\r
      "VUuid" : "${Create New Contact With Valid Data#Response#$['VUuid']}"\r
   }\r
}</con:request>
        <con:originalUri>https://qamob.cmicpaas.com/cmicqadaily/cmic-field-rest-api/jersey/v1/contacts/assign-to-project</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="fe465719-e3ab-437d-a817-784e271f2fde" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="e98d39a5-f6d5-42ff-a79d-6a073ebb1f9f" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters/>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Delete Contact" id="3b96f868-da9c-4fb9-b143-ab4b17ad471d">
    <con:settings/>
    <con:config service="ConstructPM Webservices" resourcePath="/cmic-field-rest-api/rest/1/contacts/{UUID}" methodName="Method 1" xsi:type="con:RestRequestStep">
      <con:restRequest name="Delete Contact" id="56d8f117-1211-4d1b-9306-6fe9393c61b5" mediaType="application/json" postQueryString="false">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:endpoint>https://qamob.cmicpaas.com</con:endpoint>
        <con:request/>
        <con:originalUri>https://qamob.cmicpaas.com/cmicqadaily/cmic-field-rest-api/rest/1/contacts/Ypa1CjR497</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="203daa33-29d2-470a-b761-a462037a9125" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>204</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Response SLA Assertion" id="c29cad08-b281-4ffd-9192-ad6ff189a0f9" name="Response SLA" disabled="true">
          <con:configuration>
            <SLA>200</SLA>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="UUID" value="${Create New Contact With Valid Data#Response#$['VUuid']}"/>
        </con:parameters>
        <con:environmentSpec>
          <con:entry environmentId="4a8025f4-94ea-4501-9fea-c97dcac8b6cf">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="666f0f54-3a2d-4ab8-b829-d61485c4034e">
            <con:authProfile>UPG</con:authProfile>
          </con:entry>
          <con:entry environmentId="e6982624-acb8-444c-873d-074f9555a666">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="8c42fbef-6237-4219-8044-b73695a4c38c">
            <con:authProfile>QADAILY2</con:authProfile>
          </con:entry>
          <con:entry environmentId="dcf09228-28f0-461d-97ba-ae52da190086">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
            <con:authProfile>TESTRAIL</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:tearDownScript>import groovy.json.JsonOutput
import java.net.HttpURLConnection
import java.net.URL

// Function to post test result to TestRail
def postTestResultToTestRail() {

    def testRailUrl = context.expand('${#Project#TestRailUrl}')
    def testRailUsername = context.expand('${#Project#TestRailUserName}')
    def testRailApiKey = context.expand('${#Project#TestRailAPIkey}')

    def projectId = context.expand('${#Project#projectID}')
    def testRunId = context.expand('${#Project#RunID}')

    def testCaseId = context.expand('${#TestCase#TestCaseID}')
    def testCaseName = testRunner.testCase.name

    def failedTestSteps = []
    def result = ""
    def statusId = 1
    def comment = ""

    for (r in testRunner.results) {
        if (r.getStatus().toString() != "PASS") {
            def stepResult = context.expand('${' + r.testStep.name + '#Response}')
            failedTestSteps.add(r.testStep.name + (stepResult ? (" - " + stepResult) : ""))
        }
    }

    if (!failedTestSteps) {
        comment = "${testCaseName} has passed successfully"
    } else {
        statusId = 5
        comment = "${testCaseName} has failed on test steps:\n${failedTestSteps.join('\n')}"
    }

    def postUrl = "${testRailUrl}/add_result_for_case/${testRunId}/${testCaseId}"

    def connection = new URL(postUrl).openConnection() as HttpURLConnection
    connection.requestMethod = 'POST'
    connection.doOutput = true
    connection.setRequestProperty("Content-Type", "application/json")
    connection.setRequestProperty("Authorization", "Basic " + "${testRailUsername}:${testRailApiKey}".bytes.encodeBase64().toString())

    def requestBody = [
            status_id: statusId,
            comment: comment
    ]

    def outputStream = connection.outputStream
    outputStream.write(JsonOutput.toJson(requestBody).getBytes())
    outputStream.flush()

    def responseCode = connection.responseCode
    def responseMessage = connection.responseMessage

    log.info("Response code: ${responseCode}")
    log.info("Response message: ${responseMessage}")
}

postTestResultToTestRail()</con:tearDownScript>
  <con:properties>
    <con:property>
      <con:name>TestCaseID</con:name>
      <con:value>104635</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:environmentSpec>
    <con:entry environmentId="a4f87cd8-f67a-452d-bd63-2a15b6cdd2b6">
      <con:authProfile>Inherit From Parent</con:authProfile>
    </con:entry>
  </con:environmentSpec>
  <con:tagId>b3e6a5b2-7267-41a5-8147-51657c14a2c6</con:tagId>
  <con:tagId>c4a9b3b0-fe4d-44b8-a1cd-e873e92e452a</con:tagId>
</con:testCase>
